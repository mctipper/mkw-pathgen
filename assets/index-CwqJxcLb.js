(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))l(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&l(r)}).observe(document,{childList:!0,subtree:!0});function c(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function l(e){if(e.ep)return;e.ep=!0;const o=c(e);fetch(e.href,o)}})();function g(t,n){requestAnimationFrame(()=>{const c=n.getBoundingClientRect();t.style.width=`${c.width}px`,t.style.height=`${c.height}px`,t.style.left=`${c.left+window.scrollX}px`})}function h(t,n){requestAnimationFrame(()=>{const c=n.getBoundingClientRect();t.style.width=`${c.width}px`})}async function m(){const t=await fetch("/mkw-pathgen//data/tracks.json");if(!t.ok)throw new Error(`Failed to load tracks: ${t.status}`);const n=await t.json();return Object.entries(n).reduce((l,[e,o])=>(l[e]={id:e,...o},l),{})}function k(t,n,c,l,e,o){c&&c!==t&&c.classList.remove("iconSelected");const r=t.classList.toggle("iconSelected"),a=r?t:null,d=r?n:null;return e.textContent=r?JSON.stringify(n):"",l.innerHTML=r?n.names.en_gb:"Select a track!",l.classList.toggle("track-selected",r),o.disabled=!r,{newSelectedIcon:a,newSelectedTrack:d}}function y(t,n,c,l){const e=c.offsetWidth/c.naturalWidth,o=c.offsetHeight/c.naturalHeight;n.innerHTML="";const r=c.height/10,a=r/2,d=document.querySelector(".selected-track"),u=document.getElementById("selected-track-store");let f=null;for(const i of Object.values(t)){const s=document.createElement("img");s.src=`/mkw-pathgen/images/track-icons/${i.icon}`,s.alt=i.names.en_gb,s.style.position="absolute",s.style.width=`${r}px`,s.style.height=`${r}px`,s.style.left=`${i.coords.X*e-a}px`,s.style.top=`${i.coords.Y*o-a}px`,s.addEventListener("click",()=>{f=k(s,i,f,d,u,l).newSelectedIcon}),n.appendChild(s)}}function S(t){return t&&typeof t=="object"&&typeof t.names?.en_gb=="string"}function w(t,n,c,l){const e=t.textContent?.trim();if(!e){console.log("No track selected");return}const o=JSON.parse(e);try{if(!S(o)){console.warn("Parsed data is not a valid Track:",o);return}}catch(r){console.error("Failed to parse track from store:",r);return}console.log("Selected track:",o.names.en_gb),console.log("Selected path mode:",n.value),console.log('Selected "end with":',c.checked),console.log("Selected include single-track:",l.checked)}function p(t,n){const c=t.startsWith("vs");n.disabled=!c,c||(n.checked=!1)}async function L(){const t={selectedTrackStore:document.querySelector("#selected-track-store"),trackIconLayer:document.querySelector(".track-icons-layer"),mapImg:document.querySelector(".base-map"),pathGenControls:document.querySelector(".map-controls"),generateButton:document.querySelector(".generate-button"),pathModeSelect:document.querySelector(".path-options-dropdown"),selectedTrackEnd:document.querySelector(".selected-track-end"),includeSingleTrackCheck:document.querySelector(".include-single-track")},n=Object.entries(t).filter(([,s])=>s===null).map(([s])=>s);if(n.length>0){const s=n.length>1?"s":"";console.error(`Missing required DOM element${s}: ${n.join(", ")}`);return}const{selectedTrackStore:c,trackIconLayer:l,mapImg:e,pathGenControls:o,generateButton:r,pathModeSelect:a,selectedTrackEnd:d,includeSingleTrackCheck:u}=t,f=await m();console.log("Tracks loaded:",f),r.disabled=!0,r.addEventListener("click",()=>w(c,a,d,u)),p(a.value,u),a.addEventListener("change",()=>p(a.value,u));function i(){g(l,e),h(o,e),y(f,l,e,r)}e.complete?i():e.addEventListener("load",i),window.addEventListener("resize",i)}L();
